effect State a = {
  val get : () -> a
  
  val set : a -> ()
}

let handle_state : a, (() -> <State a, b> c) -> <b> (a, c) =
  \init f ->
    ((handle f () : f
    | x -> (\(s : h) -> (s, x)) : h -> <d> (h, g)
    | <get ()> -> \s -> (resume s : h -> <d> (h, g)) s : (h, g)
    | <set s> -> \_ -> (resume () : h -> <d> (h, g)) s : (h, g))
      : h -> <d> (h, g))
      init
      : (a, c)
